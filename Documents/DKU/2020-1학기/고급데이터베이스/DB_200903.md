# 목차

1주차

[20.09.03(목)](#200903)

2주차

[20.09.08(화)](#200908)

[20.09.10(목)](#200910)

3주차

[20.09.15(화)](#200915)

[20.09.17(목)](#200917)

4주차

[20.09.22(화)](#200922)

[20.09.24(목)](#200924)

5주차

[20.09.29(화)](#200929)

# 200903

## 수업 개요

1. 저번 Quiz(학습상태 확인) 기반으로 관계형 모델 복습 겸 설명
1. 수업에서 사용할 2개의 DB에 대한 설명
1. MS SQL Server 설명(웹사이트 문서 기반으로)

## 기타사항

- 다음 시간엔 Google meet 사용해 실시간 수업해볼것임
- 오늘 진행한 프로그램 설치 과정 import 과정 과제로 낼 것
- 다음 수업 시작할 때 퀴즈낼 것(ms sql server rdbms 설명한 구성요소들)

## 1. 저번 Quiz(학습상태 확인) 기반으로 관계형 모델 복습 겸 설명

- 최근 다양한 데이터 모델들이 사용되고 있으나 아직도 대부분의 시스템들은 관계형 모델을 지원하고 있다. 관계형 모델의 특징을 쓰시오.

관계형 모델: **릴레이션의 집합**으로 데이터를 표현하는 것
릴레이션 - raw(또는 tuple)들의 집합.
그 tuple 들은 릴레이션 스키마에 정의된 구조를 갖는 tuple
스키마: 릴레이션의 이름, 컬럼들의 이름과 형태를 정의

관계해석:
관계대수: 처리 절차?

- 관계형 모델에서 기본 키가 필요한 이유를 쓰시오.

ch3 ppt
13페이지
어떤 두 튜플도 같을 수 없다

기본키의 정의

p.16

- 외래 키(foreign key)의 의미를 쓰시오.

p.15
필드(혹은 필드의 집합)가 다른 릴레이션의 튜플을 참조할 때 그것을 외래키라고 한다.

- 저장 프로시저(stored procedure)의 의미와 특징을 쓰시오.

강의 콘텐츠에 저장 프로시저에 대한 내용 올려주신대(어디까지 설명해야될지 막막하시대) - sql server tutorial 웹사이트 참고

- Employee(직원)은 ID, Name, Department(부서 명), Title(직책), 그리고 ReportsTo(직속상관)의 속성을 갖는다. 이 테이블을 정의하는 Create table문을 쓰시오. 단 타입은 적당히 가정하고 기본 키와 외래 키를 포함하여 정의하시오.

## 2. 수업에서 사용할 MySQL에 대한 설명

- www.mysqltutorial.org 사이트 내용 참고
  - 설치 방법, 예제 DB 설명
  - 기본 문법 등의 설명 소개
  - 예제 DB 설치 script의 설명을 통해 기본 문법 설명
  - 관련 링크는 아래 제시됨.

mysql 설치 후 2가지 클라이언트를 통해 사용 가능

1. 콘솔기반
2. 워크벤치(설치필요)

첫번째 과제가 아마 employees 샘플 테이블 로 쿼리문 작성해보는 것

샘플데이터 import 하고

Create 문에서 KEY 라는 명령어는 인덱스를 생성하는 것

## 3. MS SQL Server 설명(웹사이트 문서 기반으로)

- www.sqlservertutorial.net
- Getting Started with SQL Server 부분 설명
- What is SQL Server 설명
  > Architecture (DBMS)
  > 주요 개념들: Storage Engine, Query Processor, File Manager, Buffer Manager, Bulk Load 등
- 설치, 예제 DB 생성 등 설명

https://www.sqlservertutorial.net/getting-started/what-is-sql-server/

sql server 관계형 데이터베이스를 관리하기 위한 시스템으로 RDBMS라고도함. 마이크로소프트사에 의해 개발되었다.

sql server architecture

![image](https://user-images.githubusercontent.com/33214449/92401720-30c07200-f169-11ea-9785-0fef9301934e.png)

아키텍처 이미지

Parser에 의해 관계대수로 나타내짐
Optimizer
그걸 처리하는 Query Executor

sqlos API
(os 기능의 일부를 자체 구현)

Relational Engine(Query processor)

### sql server 설치

Developer 버전 쓸 것(무료)

`14.` 과정에서 되면 Mixed Mode로 pw 설정하기
sql server 2019 버전은 설치과정의 상당부분의 스크린샷이 안 나올 수도 있음

## 과제

1. MySQL과 Workbench를 설치하고 예제DB(classicmodels)를 생성하는 내용입니다. 9/3 강의 내용 중 MySQL 관련 웹사이트 내용을 참고해서 MySQL, Workbench를 설치하고 사이트에서 제공하는 예제 DB(classicmodels)를 생성합니다. Workbench의 navigator 탭에서 classicmodels DB가 설치되었음을 확인하는 스크린캡처 화면을 제출하면 됩니다.

2. 본인 이름의 DB를 생성하고 이 데이터베이스 내에 퀴즈 문제의 Employee 테이블을 생성한 후 스크린캡처 화면을 제출하세요.

3. (선택사항) MS SQL Server와 SSMS도 설치해보고 BikeStores라는 예제 DB를 생성해보세요. 이는 선택 사항입니다.

---

# 200908

2주차

2020.09.08(화)

## MSSQL

스토리지엔진 - 데이터베이스 어떻게 처리하고 버퍼 어떻게 처리하는지

### 설치

windows authentication
자동으로 설정됨
윈도우 아이디, 비번 쓰면됨

SSMS도 설치(studio)

sample db(BikeStores)
mssql 여기서 스키마: 데이터베이스들 오브젝트들의 그룹을 만들어주는(ex 샘플데이터에서 sales, production 으로 테이블들이 그룹지어 나눠져있음)
(표준적으로 데이터베이스 = 스키마)

ER다이어그램 표기 알고있나?(선 포함)

까마귀발처럼 생긴거(일대다 할 때 다)
동글뱅이에 하나있으면 일대일(하나의 고객이 여러개의 주문가능하니까)
동글뱅이는 옵셔널(모든 고객이 주문을 했었어야하는 건 아니다)

sqlserver ppt

master db 없어서는 안됨

데이터베이스 생성시
행 데이터 : 실제 데이터 저장되는
로그: 로그파일(액티비티가 기록됨)

```sql
use master
go

create database database명
go
```

mysql은 저장프로시저를 써서해야됐었는데
sql server는 스크립트를 입력하기 쉬움

batch 개념 -> ppt
컴파일단위!
안에 에러있으면 전체 실행시키지 않음
go가 구분자
저장프로시저의 끝을 표현할 때도 go를 사용

T-sql ppt(두번째 피피티)

전역변수:이미 선언된 변수. 읽기전용으로 사용 가능

우리가 앞으로 배울 내용 핵심 sql server indexes
키값을 이용해 데이터가 어딨는지 빠르게 찾는. index가 각각 붙어있음 (실제 데이터는 맨 아래 데이터 페이지로 나눠져 저장되어있음)

순차탐색보다 depth타고 들어가 인덱스로 빠르게 찾는게 빠름

mssql 내부에서는 데이터를 데이터페이지라는 단위로 저장함(크기도 설정해놓을수있나 그럼)

---

# 200910

## 과제

```sql
select concat(e.lastName, " ", e.firstName) as FullName from employees as e join offices as o on e.officeCode = o.officeCode where o.country = "UK";
```

mysql workbench에서 er다이어그램 쉽게 출력할 수 있대

4번문제는 3개의 테이블 필요할것
입력-> insert문 사용하라는 것
classmodel 디비에 customer이 일련의 회사인데 여기다가 주문, 주문상세 추가해보래
주문상세는 주문이 여러개일 수 있으니까 만드는 것

그 회사의 주문내역을 테이블에 만들어놓으라는 것

**ms sql server**

1번

- 유의 현재 데이터베이스를 삭제하려면 다른 데이터베이스로 옮겨야됨
  use master
  go

drop database testDB
go

이런식으로 해야함

그리고 테이블을 마스터에다 생성하지말 것

학사 db 파일은 제공될 것

### 학사 DB 파일

```sql
/* 본 과제는 간단한 수준의 학사DB를 구성하는 내용으로
   student, course, department, instructor, course_taken으로
   구성된다. 본 과제를 통해 학생들은 테이블 간의 참조 관계를 고려한 테이븓들의 생성,
   그리고 자기 참조 테이블의 경우 데이터들 간의 참조 관계를 고려한 데이터 입력을 경험한다.
   또한 기본 키, 외래 키를 포함한 주요 제약조건 constraint의 이름을
   명시하여 오류 발생 시 어떤 오류인지 확인할 수 있도록 한다.
*/

# 데이터베이스의 생성
drop database if exists 학사DB;
CREATE DATABASE IF NOT EXISTS 학사DB;
USE 학사DB;

# department 테이블의 생성과 데이터 입력
CREATE TABLE IF NOT EXISTS department (
	id CHAR(10) NOT NULL,
	name CHAR(10),
	constraint pk_department PRIMARY KEY (id)
);

INSERT INTO department (id, name) VALUES
	('cs', '전산전공'),
	('ss', '통계전공');

# instructor 테이블의 생성과 데이터 입력
CREATE TABLE IF NOT EXISTS instructor (
	pid CHAR(10) NOT NULL,
	name CHAR(10) NOT NULL,
	dept CHAR(10),
	constraint pk_instructor PRIMARY KEY (pid),
	constraint uniq_instructor UNIQUE KEY (name),
	constraint fk_instructor_department foreign key(dept) references department(id)
);

INSERT INTO instructor (pid, name, dept) VALUES
	('cs10', '구자영', 'cs'),
	('cs11', '우진운', 'cs'),
	('cs12', '유해영', 'cs'),
	('cs13', '이석균', 'cs'),
	('cs14', '조경산', 'cs'),
	('cs15', '조성제', 'cs'),
	('ss16', '이강섭', 'ss'),
	('ss17', '황형태', 'ss'),
	('ss18', '이장택', 'ss');

# course 테이블의 생성과 데이터 입력
CREATE TABLE IF NOT EXISTS course (
	id CHAR(10) NOT NULL,
	name CHAR(20),
	instructor CHAR(10),
	prerequisite CHAR(10),
	PRIMARY KEY (id),
	Constraint fk_Course_Instructor foreign key(instructor) references instructor(pid),
	CONSTRAINT fk_Prerequisite_Course foreign key(prerequisite) references course(id)
);

INSERT INTO course (id, name, instructor, prerequisite)
VALUES 	('cs111', '기초전산', 'cs13', NULL);

INSERT INTO course (id, name, instructor, prerequisite)
VALUES	('ss111', '전산통계', 'ss18', NULL);

INSERT INTO course (id, name, instructor, prerequisite)
VALUES	('cs211', '수치해석', 'cs12', 'cs111');

INSERT INTO course (id, name, instructor, prerequisite)
VALUES	('cs221', '자료구조론', 'cs11', 'cs111');

INSERT INTO course (id, name, instructor, prerequisite)
VALUES	('cs222', '시스템프로그래밍', 'cs10', 'cs111');

INSERT INTO course (id, name, instructor, prerequisite)
VALUES	('cs311', '컴퓨터 구조론', 'cs14', 'cs111');

INSERT INTO course (id, name, instructor, prerequisite)
VALUES	('cs312', '알고리즘', 'cs11', 'cs221');

INSERT INTO course (id, name, instructor, prerequisite)
VALUES	('cs321', '프로그래밍언어론', 'cs13', 'cs221');

INSERT INTO course (id, name, instructor, prerequisite)
VALUES	('cs322', '운영체제', 'cs15', 'cs222');

INSERT INTO course (id, name, instructor, prerequisite)
VALUES	('cs411', '데이타베이스', 'cs13', 'cs321');

INSERT INTO course (id, name, instructor, prerequisite)
VALUES	('cs413', '컴퓨터네트워크', 'cs14', 'cs311');

INSERT INTO course (id, name, instructor, prerequisite)
VALUES	('ss311', '응용해석학', 'ss17', 'ss111');

INSERT INTO course (id, name, instructor, prerequisite)
VALUES	('ss312', '통계적 품질관리', 'ss16', 'ss111');

INSERT INTO course (id, name, instructor, prerequisite)
VALUES	('cs421', '소프트웨어 공학', 'cs12', 'cs312');

INSERT INTO course (id, name, instructor, prerequisite)
VALUES	('ss321', '회귀분석', 'ss18', 'ss312');

# student 테이블의 생성과 데이터 입력
CREATE TABLE IF NOT EXISTS student (
	id CHAR(10) NOT NULL,
	name CHAR(10) NOT NULL,
	major CHAR(10) DEFAULT NULL,
	address CHAR(30) DEFAULT '단국대학교',
	gpa FLOAT,
	bdate date,
	constraint pk_student PRIMARY KEY (id),
	constraint fk_student_department foreign key(major) references department(id)
);

INSERT INTO student (id, name, major, address, gpa, bdate) VALUES
	('930405', '한나라', 'cs', '서울 마포구 원효로', 3.299999952, '1974-06-12'),
	('940123', '강동희', 'ss', '서울 중구 필동', 3.625, '1975-08-07'),
	('950564', '허영만', 'cs', '서울 강동구 풍납동', 1.75, '1976-12-21'),
	('960157', '이동주', 'cs', '서울 서초구 잠원동', 1.799999952, '1977-10-10'),
	('970734', '조용필', NULL, '서울 영등포구 영등포동', 2, '1978-07-12'),
	('980115', '이미숙', 'ss', '서울 서초구 반포동', 3.75, NULL),
	('980397', '조용기', NULL, '서울 서대문구 홍은동', 2.25, NULL);

# course_taken 테이블의 생성과 데이터 입력
CREATE TABLE IF NOT EXISTS course_taken (
	no INT(5) NOT NULL auto_increment,
	sid CHAR(10),
	cid CHAR(10),
	grade FLOAT,
	year_taken INT,
	PRIMARY KEY (no),
	foreign key(sid) references student(id),
	CONSTRAINT fk_CourseTaken_Course foreign key(cid) references course(id)
);


INSERT INTO course_taken (sid, cid, grade, year_taken) VALUES
	('930405', 'cs111', 2.0, 1993),
	('930405', 'cs211', 4.0, 1996),
	('930405', 'cs221', 3.0, 1996),
	('930405', 'cs222', 3.0, 1996),
	('930405', 'cs311', 3.0, 1997),
	('930405', 'cs321', 4.0, 1997),
	('930405', 'cs411', 4.0, 1998),
	('940123', 'ss111', 2.0, 1994),
	('940123', 'cs111', 4.0, 1997),
	('940123', 'cs221', 4.0, 1997),
	('940123', 'ss311', 4.0, 1997),
	('940123', 'ss312', 4.0, 1998),
	('940123', 'ss321', 3.0, 1998),
	('950564', 'cs111', 2.0, 1995),
	('950564', 'cs211', 2.0, 1996),
	('950564', 'cs222', 1.0, 1997),
	('950564', 'cs311', 2.0, 1998),
	('950564', 'cs411', 2.0, 1999),
	('960157', 'cs111', 1.0, 1996),
	('960157', 'cs211', 2.0, 1997),
	('970734', 'cs111', 1.0, 1997),
	('970734', 'cs211', 3.0, 1998),
	('970734', 'cs222', 2.0, 1998),
	('980115', 'ss111', 4.0, 1998),
	('980115', 'cs111', 3.0, 1998),
	('980115', 'cs221', 3.0, 1998),
	('980115', 'cs222', 4.0, 1998),
	('980115', 'cs311', 4.0, 1999),
	('980397', 'cs111', 2.0, 1998),
	('980397', 'cs211', 2.0, 1999);

```

## 관계대수(Relational Algebra) (이번 학기 내내 사용)

관계해석은 사용은 x

피피티:relational algebra

p.2
쿼리언어: 데이터 조작과 검색!

R모델은 파워풀한 쿼리언어 제공

- 관계해석 - 의미 전달이 명확하게 이루어지는 것(sql은 관계해석에 더 가까움)
- 관계대수

turing machine관련해서 설명하심
앨런튜링

3페이지

관계대수 - 절차적 실행플랜 표현하기 용이
관계해석 - 어떻게 계산하는지는 표현할 수 없음

4페이지
쿼리는 릴레이션 인스턴스에 적용됨
쿼리의 결과 역시 릴레이션 인스턴스

그리고 우리 주로 필드명 썼는데 숫자도가능(1번째면 1)

5페이지

뱃사람이 배예약하는 경우

6페이지

관계대수

셀렉션: 조건을 걸고 행들을 추출
프로젝션: 원치않는 컬럼을 제외

추가적인 연산:
교집합, 조인, 디비전, 리네이밍(테이블 혹은 필드명 변경)

연산의 결과가 또 다른 연산의 입력으로 될 수 있음.(sql 쓸때 중첩 질의문처럼)

7페이지

오른쪽 위 그림은
sname, rating 빼고 제외하고 가져오는 것

결과의 스키마-필드들이 될 것(?)

중복을 제거한다(but 리얼시스템에선 중복을 제거하지 않는다고 보는게 맞대)

9페이지

합집합/교집합/차집합하려면 필드수가 같아야되고 각각 대응하는 위치에 필드가 같은 타입이어야함

단, 필드이름이 다를 수 있는데
첫번째 인수의 릴레이션의 이름을 따를 것

10페이지

크로스프로덕트

가능한 조합이 모두

5행 \* 10행 = 50행의 결과

같은 필드가 있으면 어떡하나?->리네이밍을 통해 컬럼이름을 변경할 수 있음

11페이지

r과 s를 조인하는데 조건은 c
(세타조인)

실제 조인을 구현할 땐 조인되는 필드 비교할 때 빠르게 하는 방법을 활용해서 한대

12페이지

이퀄리티조인(조건에 이퀄리티 비교만 사용되는 경우)
sid 같은거 조인하고 sid는 하나만 남김

내추럴조인
알아보기
이것도 컬럼명 쓸 필요 없다는데..

## Q&A

Q. 데이터베이스에서 스키마란?

# 200915

3주차

## 수업 개요

1. 과제 설명

2. Relational Algebra 설명

   - relational data model: set, relation의 개념을 기반으로 간단히 소개
   - 다음 링크 참조: https://en.wikipedia.org/wiki/Relational_algebra
   - Ch4(R-Algebra)의 PPT

3. relational algebra 연습

   - 다음 파일 참고: Ch4(RelationalAlgebraExampleFromBook).hwp

## 수업 내용

저번시간 복습. ch4 피피티

8페이지

프로젝션, 셀렉션 같이 쓸 수 있음
쓰는 순서를 바꾸면 컬럼줄이고 검색하니 좀 효율적일 수도 있겠지
가독성엔 그대로가 좋고

16페이지
솔루션1 솔루션3 중 뭐가 빠른지는.
솔루션 1이 효율적일수있겠지만
조건이 저거인 결과가 많은 테이블일경우 빠르게 조인할 수 있는 인덱스가 있는 경우는 솔루션 3이 좋을 수도
경우에 따라 무엇이 효율적인지는 달라질 수 있음

17페이지
다양한 솔루션이 있을 수 있다.

18페이지
red인거는 temp1, green인거는 temp2
temp1, temp2 union하면 and 문제도 풀 수 있음

19페이지
교집합 쓰면 red 배 예약하고 green 배도 예약한 사람 나올 것

13페이지
디비전
모든 배를 예약한 sailors 구하라->디비전써야 구할 수 있음

14페이지
a/b1
b1에 모든 값을 포함한 a를 구하라

b의 값을 다 포함하되 a의 앞에 필드가 같아야돼

솔루션은 20페이지에 있음

## 과제 참고 url

https://infodbbase.tistory.com/3

https://clover7-webnote.tistory.com/124

https://oddly.tistory.com/37

https://m.blog.naver.com/PostView.nhn?blogId=wideeyed&logNo=221435077767&proxyReferer=https:%2F%2Fwww.google.com%2F

https://coding-factory.tistory.com/87

https://terrorjang.tistory.com/68

https://stackoverflow.com/questions/6520999/create-table-if-not-exists-equivalent-in-sql-server

https://coding-factory.tistory.com/79

https://extbrain.tistory.com/55

https://snowple.tistory.com/360

https://extbrain.tistory.com/56

https://futurists.tistory.com/17

# 200917

- 수업 개요

SQL 복습 과제 리뷰

    중간고사에 막 복잡한 쿼리를 내지 않을거고 그래도 기본적인 문법들은 다 알아야함

- 수업 내용

## SQL 복습 과제 설명

### A번 문제

2-(a)

- 풀이1

firstname + lastname 순서로 해야되는데...성을 먼저 써버렸네 😅

- 풀이2

`using`을 이용한 에코조인! 양쪽 테이블의 조건에 사용되는 필드이름을 주고 에코조인을 실행

- 풀이3

natural join

2-(b)

이런걸 관계대수로 표현할 수 있어야함

고객회사에 대해 담당직원이 배정되지 않은 경우(null)도 있음

2-(d)

- 풀이1

orderdetails 테이블에서 group by를 이용해 주문번호별로 퀀티티\*가격을 모두 합친걸 구함

혹시 중복있을까하여 distinct 사용

round 와 인수 이용해 소수점 둘째자리까지 반올림

2-(e)

- 풀이1

mysql 에서도 변수를 선언하는 방법도 있음

쿼리문에 변수 사용 가능

limit 1 : 반환결과를 하나로 지정

@OrderNo : 주문금액을 내림차순으로 정렬해 한개 추출

4번

입력하는 쿼리들 순서가 바뀌면 안될 것(실제 어플리케이션이라고 생각하고 해보기)

### B번문제 MS SQL

`use master;` 넣었어야됨

2-(a)

null 인 것도 포함을 시키려면 left outer join을 사용해야함

2-(b)

mssql은 차집합역할을 하는 except 연산을 지원함

2-(c)

intersection? 처럼 and

## 피피티 진도

Ch4(R-Algebra) 피피티

13페이지 디비전 다시 설명

20페이지

디비전 예시

모든 전산학과목을 수강한 학생들의 학번과 이름을 구하시오.

(전산학 과목 id)-(학생들이 수강한 과목 id)
위 전체에 존재하지 않는(not exists)

except는 빼는 것과 같음

잘 이해안되네...

# 200922

- 수업 개요

언택트환경이 지속할 것 말씀하심

- 수업 내용

## 과제 설명

A번문제. Ch4(RelationalAlgebraExampleFromBook).hwp 파일의 3,4,7,8번을 풀어라(이건 피피티에 해답이 없었음)
https://simsimjae.tistory.com/92

B번문제.

책의 카피에 대한거-book copies (카피란 해당도서관도 여러 브랜치가 존재한다는 것(단대 도서관이 죽전도 잇고 천안도 잇는것처럼) -> library_branch)

publisher 책에대한 출판사

borrower 빌리는거(빌린사람의 카드넘버가 기본키)
책을 빌리면 어디 브랜치의 어느 책을 빌리는지 정보가 있어야될 것
(다만 어느 카핀지는 이 스키마는 고려하지 않는 듯)

book_loans는 세개의 키 합쳐져서 기본키 효과를 냄(후보키 공부하기)

## 수업

ch8 피피티
인덱스가 어떻게 만들어지는지 배울것

2페이지 + 9페이지 참고

이런 외부 저장장치는 페이지단위로 탐색하고 페이지는 레코드들로 이루어져있는데

레코드아이디(레코드 식별을 위함):페이지아이디(page001) + 해당페이지에서의 위치정보(001:offset) 로 표현-> 1421페이지의 1로우 를 1421.1로 표현(피피티 8페이지 참고)

인덱스란? 또다른 파일의 형태. 데이터파일과 대부분 별도의 개념으로서 서치 키가 주어지면 rid를 빠르게 찾아낼 수 있는 데이터 스트럭쳐임
9페이지
왼쪽에 크게 네모 쳐진게 인덱스(search 키가 주어져있음-> eid)
맨오른쪽이 데이터

버퍼매니저: 외부 저장장치에서 페이지를 메인메모리로 올리는 단계
(mssql tutorial 사이트에서 본적있을걸 - mssql 구조)

3페이지

파일의 구성

heap files
순서에 상관없이 저장됨
검색을 하면 레코드 수가 n이면 빅오 n

sorted files
데이터 입력시에 데이터를 순서대로 정렬
키에 따라 정렬?
빅오 log n

indexs
인덱스 구성 방법에 따라 검색 시간 달라짐
대표적인 구조가 트리 인덱스랑 해시 인덱스가 있음
9페이지에서 봤던게 트리인덱스 유형
search key 필드 이용 빠르게 검색 가능
대신 업데이트시(수정, 삭제) 적절한 곳에 넣고 삭제 후 정립 시켜줘야되기 때문에 약간 이슈 있음

8페이지는 아마 힙 파일
9페이지는 키에따라 정렬되어있음을 볼 수 있음. sorted files. 이외의 인덱스도 주어져있는 상태

4페이지

serchkey는 여러 필드로 구성될 수도 있음/테이블의 기본키와 같지 않을 수도 있음

9페이지 보면 데이터 엔트리는 네모네모 들...
인덱스는 데이터 엔트리의 집합으로 볼 수 있음
데이터엔트리는 키가 주어졌을 때 데이터 엔트리를 k\*라고 표현함

5페이지
경우는 빨간색 글씨처럼 여러경우가 있을 수 있음
이해하기 어려울 수 있음
1번째 인덱스안에 데이터레코드가 같이 있는 경우(?)
3번째 키에 대한 레코드가 여러개 있을 때

8페이지에서 데이터엔트리는 세번째 세로줄이래
앞에것들은 나중에 설명할 인덱스 엔트리고

6페이지
클러스트인덱스를 의미(?)
인덱스 자체에 데이터 파일이 존재하는경우
(힙파일이나 솔티드파일 필요없을 것)

인덱스 하나밖에 없을 것
데이터파일마다 인덱스가 하나밖에 없을 것
데이터파일이 커지면 인덱스도 커질 것

7페이지
데이터레코드보다 데이터엔트리가 작을 수 밖에 없음
(데이터레코드랑 데이터 엔트리가 따로 있는 경우이기 때문에)
데이터엔트리는 키값, rid값으로 이루어지기 때문에
search key가 작은 경우 데이터 엔트리는 엄청 작을 것

8페이지
데이터 엔트리가 rid 리스트에 따라 크기가 달라질 것

뭔소리지...

지금까지 보여준 예제는 b+ 트리와 비슷한 애들이래

해시란?
키가 주어지면 해당 페이지 주소로 키가 바껴서 데이터엔트리를 찾아 데이터 레코드를 발견하는..
좀 다른 형태의 인덱싱 테크닉

5페이지 의 대안3개(데이터엔트리 구성방법)는
어떤 테크닉을 쓰더라도 각각 적용 가능하다

10페이지

인덱스의 종류

프라이머리 인덱스
인덱스의 키가 기본키를 포함하는 경우

세컨더리 인덱스

/

클러스터인덱스
데이터레코드가 데이터엔트리와 같은?(혹은 비슷한) 구조일때 (아까 대안1에 해당)
항상 클러스터인덱스=대안1 개념 은 아님

언클러스터인덱스

11페이지
대안 2를 기준으로 예시를 보여주고있음

# 200924

- 수업 개요

1. Index 관련 기본 개념들 정리

   - Data Entry (Alt1, Alt2, Alt3),
   - Data Record
   - Index Entry
   - Clustered Index
   - NonClustered Index

2. B+ Tree index와 Hash Index 설명

3. MS SQL Server에서 Index 예시 및 설명

   - https://www.sqlservertutorial.net/sql-server-indexes/

4. 파일 유형에 대한 기본 연산들의 비용 추정

- 수업 내용

chap8

3페이지

힙파일

소티드 파일
서치키 중심으로 정렬이 되어있는 파일

인덱스
빠르게 탐색가능한 데이터 스트럭쳐

rid 페이지id+offset 으로 구성
k\*는?

5페이지
k\*의 세가지 대안

11페이지

오른쪽 그림이 언클러스터드

12페이지

키값이 주어지면 특정 숫자가 만들어짐
이 숫자가 페이지로 매핑이 이루어진대

그림
키를 이용 버켓에 나누어 담고

데이터엔트리는 한단계, 경로 많지 않고
쉽게 엔트리 찾을 수 있음(이퀄 비교는 쉽대)
석균어...모르겠다
실제 해시 인덱스에 대안1이 적용되진 않음

13페이지

이진트리는 키가 하나
비쁠트리는 키가 m개 주어질 수 있음

14페이지
28을 키로 가지는 데이터 찾을라면...(28없네)

15보다 큰거
16 그리고 옆에랑 포인터 연결되어있어서 뒤로 쭉 읽으면 됨
비쁠 트리 편리하고 파워풀하대

데이터엔트리는 키값과 rid로 이루어져있대
여기서 맨 아래단이 데이터엔트리고
위에서 부터의 노드들은 인덱스 엔트리

- MSSQL 튜토리얼에 있는 인덱스 설명으로 공부해보자

mysql
스키마=db

mssql
스키마=db내에서 관련있는 데이터 오브젝트들을 모아놓은 그룹(이걸통해 접근제어를 하기도함. )

https://www.sqlservertutorial.net/sql-server-indexes/sql-server-clustered-indexes/

bicycle 샘플데이터임

create table production.parts...

여기서 production 이 스키마
여기에 parts라는 테이블 만들고 있는 것

기본키도 없어서 이건 heap에 저장될 것
검색할 때 힙이니까 인덱스가 없음. 테이블 스캔을 순차적으로 해서...(테이블 전체를 읽음)

어떻게 빠르게 검색가능한가? 인덱스 사용

클러스터드인덱스 = 대안1(데이터엔트리=데이터레코드)

mysql 은 클러스터드인덱스가 효과적이다 그러면 기본키 설정할 때부터 잘해야됨 / 클러스터드인덱스 하나밖에 못만든대 기본키필드에 대해서 / 넌클러스터인덱스를 잘 만드는게 중요<?
mssql같은건 상관없음

SQL Server Clustered Index and Primary key constraint

클러스터인덱스가 이미 있는 테이블에 기본키 추가하면 sqlserver는 넌클러스터인덱스를 사용한 기본키를 추가하게된다

CREATE CLUSTERED INDEX ix_parts_id
ON production.parts (part_id);

인덱스 이름 별칭 설정
인덱스를 만들어달라

https://www.sqlservertutorial.net/sql-server-indexes/sql-server-create-index/

일단 여기는 피피티그림볼것

city의 논클러스터인덱스를 만들어서 더 빠르게 탐색(index seek)

이진트리 공부할 때 키가 복수개인거 본적있나?
비쁠트리의 장점

index scan(테이블 전체가 아니라 index scan. 데이터엔트리만 스캔한다는 거)
데이터엔트리가 최근에들어 rid -> 클러스터인덱스의 키값

자꾸 질문해라
질문하면서 내용정리도되고 답변들으면서 대화하면서 내용정리도됨
설명듣는 걸 다 알아들을 수는 없음. 그래서 질문해야됨

# 200929

5주차

3페이지

복습

힙파일 - 데이터 레코드 순서가 임의적

솔티드 파일 순서대로 정렬된

인덱스
유형나뉨
어떤 데이터 구조를 사용하냐에 따라 - b+트리, 해시 인덱스
데이터 엔트리 저장순서와 데이터 레코드 저장 순서가 같은지에 따라 - 클러스터드 인덱스, 논클러스터드 인덱스로 나눌 수 있음

11페이지

데이터레코드까지도 순서 동일 -> 클러스트 인덱스

데이터레코드는 (정렬되어있을수도 안되어있을수도- 힙파일에 논클러스트 인덱스 만들 수 있음) 임의의 순서-> 논클러스트 인덱스

12페이지

해시 인덱스

버킷이 데이터엔트리 페이지라고 생각하면 됨
해시인덱스는 논클러스트
버킷들에 해시펑션에 의해 매핑됨

13페이지
비쁠트리

데이터엔트리 leaf - 키와 rid의 레코드들로 구성

non-leaf 인덱스 엔트리 -> 맨 아래 구성을 포함. 부모와 자식 페이지간의 연결을 포인터로

15페이지

cpu 코스트 포함시키지 않는다고 가정하고 비용 판단할 것(io에 비해 영향 적음)

미리 주변꺼 읽어 fetch해서 얻는 이점은 무시하는 걸로

16페이지

비쁠 트리 기반 클러스트 인덱스
비쁠 트리 기반 넌 클러스트 인덱스
해시 기반 넌 클러스트 인덱스

3가지로 나눌 수 있음

주목: 넌클러스트인덱스가 사용되는 경우 해당 데이터 파일은 모두 힙파일로 나타난대

17페이지

크게 4가지 연산

순차적으로 읽는 scan

이퀄비교하는 서치

범위

페이지에 특정 레코드를 쓰고 지우는 연산

18페이지

가정

힙파일
매치하는거 하나만 찾겠다

솔티드 파일
특정 레코드 삭제되면 컴팩션 일어나게해서 빈공간 없이 꽉 채우겠다는
->비현실적이긴함

굳이이런 가정하는 이유는 레코드가 순서대로 정렬되어있다는

인덱스

해시: 버킷에 빈공간이 잇게 해 충돌 안나게 ..가정
버킷의 한 80퍼만 차도록
80퍼씩 채우면 해당 페이지의 수가 1.25배 늘어난다는 것(?)

트리
해시와 유사한 가정 필요
14페이지 참고
꽉채우지 않음(꽉채우면 삽입시 트리에 변화가 일어나야함)
2/3 만 채우니까 3/2=1.5 배의 페이지 수 필요

19페이지

(3) 클러스터는 클러스터 비쁠트리 나타내는 거래

고민, 추론해서 칸을 채울 것

2번째 강의

캡처사진 1번 페이지
D: 읽고쓰고 할 때 비용

데이터 엔트리는 키와 rid로 이루어짐. 레코드사이즈의 10퍼정도로 작음

67퍼만 데이터 엔트리 채울 수 있으면
1/3만큼 늘어날 수 밖에 없음. 2/3을 거꾸로 하면 3/2가 될거고
원래 필요한 페이지 수에 3/2배

2번 페이지

클러스터 인덱스
데이터엔트리와 레코드가 통합된 형태

언클러스터
데이터엔트리 각각이 데이터 레코드를 표현하게끔 되어 있음
데이터 엔트리 수 = 데이터 레코드 수

언클러스터 트리 인덱스
트리니까 1.5배(앞페이지 참고)
0.1은 데이터 엔트리사이즈가 작아져서 발생하는 숫자. 이것도 곱해줌
그럼 데이터 엔트리의 수는 이렇게 될 것

해시인덱스
80퍼로 인해
증가해야하는 비용은 1.25

3번 페이지

이퀄리티. 같은거 존재한다는 전제하에 서술한 것

힙의 경우...
힙파일의 인서트는 맨 끝 페이지에(파일의 끝) 저장
맨 마지막 페이지 읽어오는 비용D. 빈공간에 쓰는 비용 다시 D라서 2D
삭제는 search+D (여기서 search는 이퀄리티 비용이랑 같다고 보면됨)

솔팅되있으면
이진 탐색 가능
전체 페이지수가 B니까 이진탐색하면 log2의 B겠지 -> 이건 몇번페이지를 읽어올지에 대한 비용이고
각각에 대해서 D만큼의 비용발생하므로
이퀄리티는 Dlog2의B
(c) 페이지탐색(로그) + 매칭 페이지의 수
(d) search하고나서 BD(compaction하기 때문에) (삽입시엔 뒤로 밀고, 삭제시엔 앞으로 채워주는)

클러스터 비쁠트리
(a) 트리인덱스 사용시 데이터페이지의수는 1.5배만큼 늘어나기 때문에
(b) F(2가 아니라 엄청 크대) 1.5B(페이지수)
(d) search비용(앞에서 계산한) + 저장하는 비용 D 발생
(e)도 위와 같은 원리

4번 페이지

논클러스트 비쁠트리

4-a

모든 데이터 엔트리 페이지 읽는 비용 0.15BD
전체 데이터 엔트리마다 실제 페이지 읽는 RB(엔트리 수)\*D

-> 데이터 엔트리 페이지를 통해 레코드를 접근하면 비용이 늘것이다

4-b

로그씌운값 \* D = 트리 서치 코스트
데이터 엔트리에 존재하는 rid가지고 리드하면 되니까 +D

4-c
범위 탐색

매칭한 것만큼 접근해야됨

4-d

4-b비용 + D + D
4-d와 4-e 는 비용 같음

5-a
클러스터인덱스랑 마찬가지로 모든 레코드를 데이터엔트리페이지들을 통해 접근
0.125*BD + BR*D = BD(R+0.125)

(b)
버켓넘버읽어오는 D, 버킷에있는데이터엔트리페이지에 있는 엔트리 정보로 페이지를 읽어오는 D

(c)
직접 전체파일 읽는다하면...

(d)
버킷페이지 읽는 D + 데이터페이지 읽는 비용D + 버킷페이지 write D + 데이터페이지 write D

석균어 ...모르겠다..정말로(구글링으로 내용 찾아봐야될듯)
